# JWT –ê–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è - –ü—Ä–æ–≥—Ä–µ—Å –≤ –£—á–µ–Ω–µ—Ç–æ

## üéØ –¶–µ–ª –Ω–∞ –ø—Ä–æ–µ–∫—Ç–∞
**–£–ß–ï–ù–ï** - —Ä–∞–∑–±–∏—Ä–∞–Ω–µ –Ω–∞ JWT –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è—Ç–∞ –∏ –ø—Ä–∞–≤–∏–ª–Ω–æ—Ç–æ —ù –ø—Ä–∏–ª–∞–≥–∞–Ω–µ –≤ Spring Boot

## üìö –ù–∞—É—á–µ–Ω–æ –¥–æ –º–æ–º–µ–Ω—Ç–∞

### 1. JWT –ê–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è –°–∏—Å—Ç–µ–º–∞ ‚úÖ
**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å—ä–∑–¥–∞–¥–µ–Ω–∏:**
- `AuthRequestDto` –∏ `AuthResponseDto` - –∑–∞ login –∑–∞—è–≤–∫–∏
- `JwtService` - –º–µ—Ç–æ–¥–∏ –∑–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —Ç–æ–∫–µ–Ω–∏
- `AuthController` - endpoint `/auth/login` –∑–∞ –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è (–∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞–Ω)
- `JwtAuthFilter` - —Ñ–∏–ª—Ç—ä—Ä –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ JWT —Ç–æ–∫–µ–Ω–∏ –ø—Ä–∏ –≤—Å—è–∫–∞ –∑–∞—è–≤–∫–∞
- `SecurityConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–µ –Ω–∞ JWT –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è, disable –Ω–∞ form login

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –°—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∞—Ç–∞ –°–∏—Å—Ç–µ–º–∞ ‚úÖ
**–ò–∑–ø–æ–ª–∑–≤–∞–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏:**
- `ExpenseTrackerDetailsService` - –∑–∞ –Ω–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
- `ExpenseTrackerUser` - –∑–∞ user details
- MySQL –±–∞–∑–∞ –¥–∞–Ω–Ω–∏ –∑–∞ production

### 3. –ù–∞—É—á–µ–Ω–∏ –ö–æ–Ω—Ü–µ–ø—Ü–∏–∏ ‚úÖ
- –†–∞–∑–ª–∏–∫–∞—Ç–∞ –º–µ–∂–¥—É `AuthenticationManager` –∏ –¥–∏—Ä–µ–∫—Ç–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- –ó–∞—â–æ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ `AuthenticationProvider`
- –ö–∞–∫ —Ä–∞–±–æ—Ç–∏ JWT token validation
- Stateless vs Session-based –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è

### 4. –î–µ—Ç–∞–π–ª–Ω–∏ –†–∞–∑–±–∏—Ä–∞–Ω–∏—è ‚úÖ
**AuthenticationManager vs –î–∏—Ä–µ–∫—Ç–Ω–∞ –í–∞–ª–∏–¥–∞—Ü–∏—è:**
- `AuthenticationManager` –µ –æ—Ñ–∏—Ü–∏–∞–ª–Ω–∏—è—Ç Spring Security –Ω–∞—á–∏–Ω
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∏—Ä–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞ –≤—Å–∏—á–∫–∏ AuthenticationProvider-–∏
- –ü–æ-–≥—ä–≤–∫–∞–≤ –∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–∞–Ω –ø–æ–¥—Ö–æ–¥

**UsernamePasswordAuthenticationToken –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏:**
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä 1: `(username, password, authorities)` - –∑–∞ –Ω–µ–∞–≤—Ç–µ–Ω—Ç–∏–∫–∏—Ä–∞–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏
- –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä 2: `(principal, null, authorities)` - –∑–∞ –∞–≤—Ç–µ–Ω—Ç–∏–∫–∏—Ä–∞–Ω–∏ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏

**JwtAuthFilter –õ–æ–≥–∏–∫–∞:**
- –ü—Ä–æ–≤–µ—Ä—è–≤–∞ `Authorization: Bearer <token>` header
- –ü—Ä–∏ –ª–∏–ø—Å–∞ –Ω–∞ header ‚Üí –ø—Ä–æ–¥—ä–ª–∂–∞–≤–∞ –∫—ä–º —Å–ª–µ–¥–≤–∞—â–∏—è —Ñ–∏–ª—Ç—ä—Ä (–ù–ï –≤—Ä—ä—â–∞ 401)
- –ü—Ä–∏ –≤–∞–ª–∏–¥–µ–Ω —Ç–æ–∫–µ–Ω ‚Üí —Å–µ—Ç–≤–∞ authentication –≤ SecurityContext
- –ü—Ä–æ–≤–µ—Ä—è–≤–∞ `SecurityContextHolder.getContext().getAuthentication() == null` –∑–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ –¥—É–±–ª–∏—Ä–∞–Ω–µ

**–ú–Ω–æ–∂–µ—Å—Ç–≤–æ AuthenticationProvider-–∏:**
- –í—ä–∑–º–æ–∂–Ω–æ –µ –¥–∞ –∏–º–∞–º–µ –Ω—è–∫–æ–ª–∫–æ providers
- Spring Security –≥–∏ –æ–ø–∏—Ç–≤–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ
- Strategy pattern –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ —Ç–∏–ø–æ–≤–µ –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è

## üß™ –¢–µ—Å—Ç–≤–∞–Ω–µ - –¢–µ–∫—É—â –ü—Ä–æ–≥—Ä–µ—Å

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –¢–µ—Å—Ç–æ–≤–∞ –°—Ä–µ–¥–∞ ‚úÖ
**–ù–∞–ø—Ä–∞–≤–µ–Ω–æ:**
1. **H2 Database –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ**
   - –î–æ–±–∞–≤–µ–Ω `testImplementation("com.h2database:h2")` –≤ `build.gradle.kts`
   - –°—ä–∑–¥–∞–¥–µ–Ω `src/test/resources/application-test.yml`
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–∞–Ω H2 —Å `create-drop` —Ä–µ–∂–∏–º

2. **JWT –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ**
   ```yaml
   jwt:
     secret: 404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970
     expiration: 86400000
   ```

### Unit –¢–µ—Å—Ç–æ–≤–µ –∑–∞ JwtService ‚úÖ
**–°—ä–∑–¥–∞–¥–µ–Ω:** `src/test/java/com/angelstanchev/expense_tracker/service/JwtServiceTest.java`

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- `@ExtendWith(MockitoExtension.class)` - –±—ä—Ä–∑ unit —Ç–µ—Å—Ç –±–µ–∑ Spring –∫–æ–Ω—Ç–µ–∫—Å—Ç
- `@BeforeEach` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–∞ JwtService —Å —Ç–µ—Å—Ç–æ–≤–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏
- –î–∏—Ä–µ–∫—Ç–Ω–æ –ø–æ–¥–∞–≤–∞–Ω–µ –Ω–∞ `secret` –∏ `expiration` –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞

**–ù–∞–ø–∏—Å–∞–Ω–∏ —Ç–µ—Å—Ç–æ–≤–µ:**
1. ‚úÖ `generateToken_WithClams_ShoulCreateValidToken()` - —Ç–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ —Å claims
2. ‚úÖ `generateToken_WithOutClaiim_ShouldCreateValidToken()` - —Ç–µ—Å—Ç–≤–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –±–µ–∑ claims
3. ‚úÖ `extractUsername_ShouldReturnCorrectUsername()` - —Ç–µ—Å—Ç–≤–∞ –∏–∑–≤–ª–∏—á–∞–Ω–µ –Ω–∞ username
4. ‚úÖ `isTokenValid_WithValidToken_ShouldReturnTrue()` - —Ç–µ—Å—Ç–≤–∞ –≤–∞–ª–∏–¥–Ω–∏ —Ç–æ–∫–µ–Ω–∏
5. ‚úÖ `isTokenValid_WithInvalidToken_ShouldReturnFalse()` - —Ç–µ—Å—Ç–≤–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–∏ —Ç–æ–∫–µ–Ω–∏
6. ‚úÖ `isTokenValid_WithNullToken_ShouldReturnFalse()` - —Ç–µ—Å—Ç–≤–∞ null —Ç–æ–∫–µ–Ω–∏
7. ‚úÖ `isTokenValid_WithEmptyToken_ShouldReturnFalse()` - —Ç–µ—Å—Ç–≤–∞ –ø—Ä–∞–∑–Ω–∏ —Ç–æ–∫–µ–Ω–∏
8. ‚úÖ `generateToken_WithClaims_ShouldThrowIfEmailIsNull()` - —Ç–µ—Å—Ç–≤–∞ null email
9. ‚úÖ `generateToken_WithClaims_ShouldThrowIfEmailIsEmpty()` - —Ç–µ—Å—Ç–≤–∞ –ø—Ä–∞–∑–µ–Ω email
10. ‚úÖ `generateToken_WithClaims_ShouldThrowIfEmailIsOnlyWhitespace()` - —Ç–µ—Å—Ç–≤–∞ whitespace email

**–†–µ–∑—É–ª—Ç–∞—Ç–∏:**
- –í—Å–∏—á–∫–∏ —Ç–µ—Å—Ç–æ–≤–µ –º–∏–Ω–∞–≤–∞—Ç —É—Å–ø–µ—à–Ω–æ
- –í—Ä–µ–º–µ –∑–∞ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ: ~1300ms (–ø—ä—Ä–≤–æ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ)

## üéì –ù–∞—É—á–µ–Ω–∏ –ü—Ä–∏–Ω—Ü–∏–ø–∏ –∑–∞ –¢–µ—Å—Ç–≤–∞–Ω–µ

### Unit vs Integration –¢–µ—Å—Ç–æ–≤–µ
- **Unit —Ç–µ—Å—Ç–æ–≤–µ** = —Ç–µ—Å—Ç–≤–∞–º–µ –æ—Ç–¥–µ–ª–Ω–∏ –º–µ—Ç–æ–¥–∏/–∫–ª–∞—Å–æ–≤–µ –∏–∑–æ–ª–∏—Ä–∞–Ω–æ
- **Integration —Ç–µ—Å—Ç–æ–≤–µ** = —Ç–µ—Å—Ç–≤–∞–º–µ –∫–∞–∫ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏—Ç–µ —Ä–∞–±–æ—Ç—è—Ç –∑–∞–µ–¥–Ω–æ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞ –¢–µ—Å—Ç–æ–≤–µ
- **H2 Database** = –±—ä—Ä–∑, –≤ –ø–∞–º–µ—Ç—Ç–∞, `create-drop` —Ä–µ–∂–∏–º
- **–û—Ç–¥–µ–ª–µ–Ω –ø—Ä–æ—Ñ–∏–ª** = `@ActiveProfiles("test")` –∑–∞ –¥–∞ –∏–∑–ø–æ–ª–∑–≤–∞ `application-test.yml`
- **–ë–µ–∑ Liquibase** = –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ –Ω–µ –Ω–∏ —Ç—Ä—è–±–≤–∞, H2 —Å—ä–∑–¥–∞–≤–∞ —Å—Ö–µ–º–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

## üöÄ –°–ª–µ–¥–≤–∞—â–∏ –°—Ç—ä–ø–∫–∏

### 1. –î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ Unit –¢–µ—Å—Ç–æ–≤–µ –∑–∞ JwtService ‚úÖ
- [x] –¢–µ—Å—Ç –∑–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–∏ —Ç–æ–∫–µ–Ω–∏
- [x] –¢–µ—Å—Ç –∑–∞ edge cases (null, empty, whitespace)
- [ ] –¢–µ—Å—Ç –∑–∞ –∏–∑—Ç–µ–∫–ª–∏ —Ç–æ–∫–µ–Ω–∏  
- [ ] –¢–µ—Å—Ç –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ —Ç–æ–∫–µ–Ω–∏ –≤—Å–µ–∫–∏ –ø—ä—Ç

### 2. Integration –¢–µ—Å—Ç–æ–≤–µ –∑–∞ AuthController
- [ ] –¢–µ—Å—Ç –Ω–∞ `/auth/login` endpoint
- [ ] –¢–µ—Å—Ç —Å –≤–∞–ª–∏–¥–Ω–∏/–Ω–µ–≤–∞–ª–∏–¥–Ω–∏ credentials
- [ ] –¢–µ—Å—Ç –Ω–∞ response —Ñ–æ—Ä–º–∞—Ç
- [ ] –¢–µ—Å—Ç –Ω–∞ error handling

### 3. Integration –¢–µ—Å—Ç–æ–≤–µ –∑–∞ JwtAuthFilter
- [ ] –¢–µ—Å—Ç –Ω–∞ —Ñ–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞—è–≤–∫–∏
- [ ] –¢–µ—Å—Ç —Å/–±–µ–∑ JWT —Ç–æ–∫–µ–Ω–∏
- [ ] –¢–µ—Å—Ç –Ω–∞ –∑–∞—â–∏—Ç–µ–Ω–∏ endpoints

### 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è Endpoint
- [ ] –°—ä–∑–¥–∞–≤–∞–Ω–µ –Ω–∞ endpoint –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –≤—Ö–æ–¥–Ω–∏ –¥–∞–Ω–Ω–∏
- [ ] –•–µ—à–∏—Ä–∞–Ω–µ –Ω–∞ –ø–∞—Ä–æ–ª–∏

### 5. Error Handling
- [ ] –ü–æ-–¥–æ–±—Ä–∏ –≥—Ä–µ—à–∫–∏ –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–∏ —Ç–æ–∫–µ–Ω–∏
- [ ] Global exception handling
- [ ] Custom error responses

### 6. Frontend –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] –ö–∞–∫ frontend-—ä—Ç –∏–∑–ø–æ–ª–∑–≤–∞ JWT —Ç–æ–∫–µ–Ω–∏
- [ ] Token storage (localStorage vs cookies)
- [ ] Token refresh –ª–æ–≥–∏–∫–∞

## üìù –í–∞–∂–Ω–∏ –§–∞–π–ª–æ–≤–µ

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `build.gradle.kts` - H2 dependency –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ
- `src/main/resources/application.yml` - production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- `src/test/resources/application-test.yml` - —Ç–µ—Å—Ç–æ–≤–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ö–æ–¥
- `JwtService` –∏ `JwstServiceImpl` - JWT –ª–æ–≥–∏–∫–∞
- `AuthController` - login endpoint
- `JwtAuthFilter` - —Ñ–∏–ª—Ç—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –∑–∞—è–≤–∫–∏
- `SecurityConfig` - Spring Security –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –¢–µ—Å—Ç–æ–≤–µ
- `JwtServiceTest` - unit —Ç–µ—Å—Ç–æ–≤–µ –∑–∞ JWT –ª–æ–≥–∏–∫–∞

## üéØ –ö–ª—é—á–æ–≤–∏ –ù–∞—É—á–µ–Ω–∏—è

1. **JWT –µ stateless** - –Ω–µ —Å–µ —Å—ä—Ö—Ä–∞–Ω—è–≤–∞ –≤ –±–∞–∑–∞ –¥–∞–Ω–Ω–∏
2. **Unit —Ç–µ—Å—Ç–æ–≤–µ —Å–∞ –±—ä—Ä–∑–∏** - –∏–∑–ø–æ–ª–∑–≤–∞–º–µ MockitoExtension
3. **H2 –µ –ø–µ—Ä—Ñ–µ–∫—Ç–µ–Ω –∑–∞ —Ç–µ—Å—Ç–æ–≤–µ** - –±—ä—Ä–∑ –∏ –≤ –ø–∞–º–µ—Ç—Ç–∞
4. **–í–∞–∂–Ω–æ –µ –¥–∞ —Ç–µ—Å—Ç–≤–∞–º–µ edge cases** - –∑–∞ –∫–∞—á–µ—Å—Ç–≤–µ–Ω –∫–æ–¥
5. **–†–∞–∑–¥–µ–ª—è–º–µ unit –∏ integration —Ç–µ—Å—Ç–æ–≤–µ** - –∑–∞ –ø–æ-–¥–æ–±—Ä–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è
6. **AuthenticationManager –µ –æ—Ñ–∏—Ü–∏–∞–ª–Ω–∏—è—Ç –Ω–∞—á–∏–Ω** - –Ω–µ –¥–∏—Ä–µ–∫—Ç–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è
7. **JwtAuthFilter –Ω–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –≤—Ä—ä—â–∞ 401** –ø—Ä–∏ –ª–∏–ø—Å–∞ –Ω–∞ header
8. **SecurityContextHolder –ø—Ä–æ–≤–µ—Ä–∫–∞** –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç—è–≤–∞ –¥—É–±–ª–∏—Ä–∞–Ω–µ –Ω–∞ —Å–µ—Å–∏–∏
9. **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ AuthenticationProvider-–∏** —Å–∞ –≤—ä–∑–º–æ–∂–Ω–∏ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ —Ç–∏–ø–æ–≤–µ auth
10. **UsernamePasswordAuthenticationToken –∏–º–∞ –¥–≤–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞** - –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ —Å–ª—É—á–∞–∏
11. **AuthController –∏–∑–ø–æ–ª–∑–≤–∞ AuthenticationManager** - –∑–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ credentials
12. **–ò–∑–±—è–≥–≤–∞–º–µ –¥—É–±–ª–∏—Ä–∞–Ω–µ** - –∏–∑–ø–æ–ª–∑–≤–∞–º–µ authentication.getPrincipal() –≤–º–µ—Å—Ç–æ userDetailsService
13. **Claims –≤ JWT —Ç–æ–∫–µ–Ω–∏** - –∑–∞ —Ä–æ–ª–∏ –∏ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
14. **Frontend —É–ø—Ä–∞–≤–ª—è–≤–∞ JWT —Ç–æ–∫–µ–Ω–∏** - localStorage, headers, validation
15. **Stateless –∞–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è** - Spring –Ω–µ "–ø–æ–º–Ω–∏" –º–µ–∂–¥—É –∑–∞—è–≤–∫–∏—Ç–µ

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –î–µ—Ç–∞–π–ª–∏

### JWT Token –°—Ç—Ä—É–∫—Ç—É—Ä–∞
```json
{
  "sub": "john@example.com",
  "roles": ["USER"],
  "exp": 1640995200,
  "iat": 1640908800
}
```

### Flow –Ω–∞ –ê–≤—Ç–µ–Ω—Ç–∏–∫–∞—Ü–∏—è
```
1. –ö–ª–∏–µ–Ω—Ç: POST /auth/login {"username": "test", "password": "pass"}
2. AuthController: AuthenticationManager.authenticate()
3. AuthenticationManager: DaoAuthenticationProvider.authenticate()
4. DaoAuthenticationProvider: UserDetailsService + PasswordEncoder
5. –ê–∫–æ —É—Å–ø–µ—à–Ω–æ: –∏–∑–≤–ª–∏—á–∞ UserDetails –æ—Ç authentication.getPrincipal()
6. –ì–µ–Ω–µ—Ä–∏—Ä–∞ JWT —Ç–æ–∫–µ–Ω —Å claims (—Ä–æ–ª–∏)
7. –í—Ä—ä—â–∞ AuthResponseDto —Å —Ç–æ–∫–µ–Ω–∞
8. –ö–ª–∏–µ–Ω—Ç: Authorization: Bearer <token>
9. JwtAuthFilter: –≤–∞–ª–∏–¥–∏—Ä–∞ —Ç–æ–∫–µ–Ω–∞
10. –ê–∫–æ –≤–∞–ª–∏–¥–µ–Ω: SecurityContextHolder.setAuthentication()
11. –ü—Ä–∏ —Å–ª–µ–¥–≤–∞—â–∞ –∑–∞—è–≤–∫–∞: –æ—Ç–Ω–æ–≤–æ –ø—Ä–æ–≤–µ—Ä—è–≤–∞ —Ç–æ–∫–µ–Ω–∞ (stateless)
```

### AuthController –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
```java
@PostMapping("/login")
public ResponseEntity<AuthResponseDto> login(@RequestBody AuthRequestDto request) {
    // 1. –í–∞–ª–∏–¥–∏—Ä–∞–º–µ credentials
    Authentication authentication = authenticationManager.authenticate(
        new UsernamePasswordAuthenticationToken(request.username(), request.password())
    );
    
    // 2. –ò–∑–≤–ª–∏—á–∞–º–µ UserDetails (–∏–∑–±—è–≥–≤–∞–º–µ –¥—É–±–ª–∏—Ä–∞–Ω–µ)
    UserDetails user = (UserDetails) authentication.getPrincipal();
    
    // 3. –ì–µ–Ω–µ—Ä–∏—Ä–∞–º–µ JWT —Ç–æ–∫–µ–Ω —Å claims
    List<String> userRoles = user.getAuthorities().stream()
        .map(Object::toString)
        .toList();
    Map<String, Object> claims = Map.of("roles", userRoles);
    String token = jwtService.generateToken(user.getUsername(), claims);
    
    // 4. –í—Ä—ä—â–∞–º–µ response
    return ResponseEntity.ok(new AuthResponseDto(token));
}
```

### Frontend JWT Management
```javascript
// –°–ª–µ–¥ login
localStorage.setItem('jwt', response.token);

// –ü—Ä–∏ –≤—Å—è–∫–∞ –∑–∞—è–≤–∫–∞
fetch('/api/data', {
  headers: {
    'Authorization': 'Bearer ' + localStorage.getItem('jwt')
  }
});

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –µ –ª–æ–≥–Ω–∞—Ç
function isLoggedIn() {
    const token = localStorage.getItem('jwt');
    return token !== null && token !== '';
}
```

---
*–ü–æ—Å–ª–µ–¥–Ω–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è: –î–µ–∫–µ–º–≤—Ä–∏ 2024* 